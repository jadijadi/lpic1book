<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Jadi" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="LPIC1, 102, LPIC1-102-500, LPIC1, " />

<meta property="og:title" content="108.1 Maintain system time "/>
<meta property="og:url" content="./1081-maintain-system-time.html" />
<meta property="og:description" content="" />
<meta property="og:site_name" content="lpic1book" />
<meta property="og:article:author" content="Jadi" />
<meta property="og:article:published_time" content="2010-12-03T10:20:00+01:00" />
<meta name="twitter:title" content="108.1 Maintain system time ">
<meta name="twitter:description" content="">

        <title>108.1 Maintain system time  · lpic1book
</title>



        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-4CZV14VZXW"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-4CZV14VZXW');
        </script>
        
    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>lpic1book</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                </li>
                                <li ><a href="./">Home</a></li>
                                <li ><a href="./support">Support/Donate</a></li>
                                <li ><a href="./archives.html">Chapters</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li><form action="https://www.google.com/search" method="get" target="_blank" class="navbar-search"> <input type="hidden" name="sitesearch" value="https://linux1st.com/"/><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./1081-maintain-system-time.html">
                108.1 Maintain system time
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <h2>108.1 Maintain system time</h2>
<div class="alert alert-danger" role="alert">
  This chapter is still a Work In Progress. Do not rely on it for LPIC version 500 exam. Will be updated in a few weeks.
</div>

<p><em>Weight: 3</em></p>
<p>Candidates should be able to properly maintain the system time and synchronize the clock via NTP.</p>
<h3>Key Knowledge Areas</h3>
<ul>
<li>Set the system date and time.</li>
<li>Set the hardware clock to the correct time in UTC.</li>
<li>Configure the correct timezone.</li>
<li>Basic NTP configuration.</li>
<li>Knowledge of using the pool.ntp.org service.</li>
<li>Awareness of the ntpq command.</li>
</ul>
<h3>Terms and Utilities</h3>
<ul>
<li>/usr/share/zoneinfo/</li>
<li>/etc/timezone</li>
<li>/etc/localtime</li>
<li>/etc/ntp.conf</li>
<li>date</li>
<li>hwclock</li>
<li>ntpd</li>
<li>ntpdate</li>
<li>pool.ntp.org</li>
</ul>
<h3>How a computer keeps its time</h3>
<p>There is a clock in your computer; a hardware clock on your motherboard! It has its own battery and keeps the time even when the computer is off. When the system boots, the OS reads this <strong>hardware time</strong> and it sets its <strong>system time</strong> to the hardware clock and uses it from there on.</p>
<p>Hardware clock can be the localtime (your computers timezone) or UTC time (standard time). You can check this by /etc/adjtime:</p>
<div class="highlight"><pre><span></span><code>$ cat /etc/adjtime
0.000000 1451741899 0.000000
1451741899
UTC
</code></pre></div>

<p>As you can see in my computer the time is set on UTC so the computers add my timezone difference each time it boots up to the hardware clock. The <code>hwclock</code> can be used to show the time based on the hwtime. See how it works based on the hardware time even after we DO CHANGE the system time:</p>
<div class="highlight"><pre><span></span><code>root@funlife:~# date
Mon Jan  4 22:01:18 IRST 2016
# date -s &quot;Jan 4 22:22:22 2016&quot;
Mon Jan  4 22:22:22 IRST 2016
root@funlife:~# date
Mon Jan  4 22:02:18 IRST 2016
root@funlife:~# hwclock
Mon 04 Jan 2016 10:02:21 PM IRST  .108596 seconds
</code></pre></div>

<blockquote>
<p>Even when the hardware clock is set on UTC, <code>hwclock</code> date shows the date in the localtime (time after adding the timezone to the UTC time)</p>
</blockquote>
<p>Older OSs used to set the hardware clock on localtime zone instead of timezone. This can be achived by:</p>
<div class="highlight"><pre><span></span><code># hwclock --localtime --set --date=&quot;01/05/2015 22:04:00&quot;
</code></pre></div>

<p>If you want to fix it, just issue:</p>
<div class="highlight"><pre><span></span><code># hwclock -u -w
</code></pre></div>

<p>In this command <code>-u</code> tell the hardware clock that this is a UTC time and <code>-w</code> tells "sync with systemtime".</p>
<h3>NTP</h3>
<p>Network Time Protocol is my favorite protocol. It is one of the coolest protocols ever if you dive into its details. But unfortunately for LPIC1 you do not need to go into NTP depths. This protocol uses NTP servers to find out the accurate time shown by best atomic clocks on this planet. One of the most famous severs used by ntp people is <code>pool.ntp.org</code>. If you check that website you will see that it is a <strong>pool</strong> of ntp servers and by giving your NTP server the <code>pool.ntp.org</code>, it will be redirected to one of the many ntp servers available on that pool.</p>
<h4>ntpdate</h4>
<p>The most straight forward command to set the systemclock is <code>ntpdate</code> and used like this:</p>
<div class="highlight"><pre><span></span><code># ntpdate pool.ntp.org
4 Jan 22:15:02 ntpdate[18708]: adjust time server 194.225.150.25 offset -0.006527 sec
</code></pre></div>

<p>After this, we need to set the hwclock to the just corrected system time by <code>sudo hwclock -w</code>.</p>
<h4>ntpd</h4>
<p>Instead of manually setting the time each time, you can use a linux service called <code>ntp</code> to keep your time using some time servers (the most famous one is pool.ntp.org). Install the <code>ntp</code> and start the server:</p>
<div class="highlight"><pre><span></span><code># apt install ntp
# systemctl start ntp
</code></pre></div>

<p>Fun fact? you can not use both! Look at this:</p>
<div class="highlight"><pre><span></span><code>root@funlife:~# ntpdate pool.ntp.org
 4 Jan 22:14:25 ntpdate[18670]: the NTP socket is in use, exiting
</code></pre></div>

<p>As you can see, now the <code>ntp</code> is using the NTP port and <code>ntpdate</code> has problems starting up.</p>
<p>Main configuration file of <code>ntp</code> is located at /etc/ntp.conf:</p>
<div class="highlight"><pre><span></span><code># cat /etc/ntp.conf
# /etc/ntp.conf, configuration for ntpd; see ntp.conf(5) for help

driftfile /var/lib/ntp/ntp.drift

# Enable this if you want statistics to be logged.
#statsdir /var/log/ntpstats/

statistics loopstats peerstats clockstats
filegen loopstats file loopstats type day enable
filegen peerstats file peerstats type day enable
filegen clockstats file clockstats type day enable


# You do need to talk to an NTP server or two (or three).
#server ntp.your-provider.example

# pool.ntp.org maps to about 1000 low-stratum NTP servers.  Your server will
# pick a different set every time it starts up.  Please consider joining the
# pool: &lt;http://www.pool.ntp.org/join.html&gt;
pool 0.debian.pool.ntp.org iburst
pool 1.debian.pool.ntp.org iburst
pool 2.debian.pool.ntp.org iburst
pool 3.debian.pool.ntp.org iburst


# Access control configuration; see /usr/share/doc/ntp-doc/html/accopt.html for
# details.  The web page &lt;http://support.ntp.org/bin/view/Support/AccessRestrictions&gt;
# might also be helpful.
#
# Note that &quot;restrict&quot; applies to both servers and clients, so a configuration
# that might be intended to block requests from certain clients could also end
# up blocking replies from your own upstream servers.

# By default, exchange time with everybody, but don&#39;t allow configuration.
restrict -4 default kod notrap nomodify nopeer noquery limited
restrict -6 default kod notrap nomodify nopeer noquery limited

# Local users may interrogate the ntp server more closely.
restrict 127.0.0.1
restrict ::1

# Needed for adding pool entries
restrict source notrap nomodify noquery

# Clients from this (example!) subnet have unlimited access, but only if
# cryptographically authenticated.
#restrict 192.168.123.0 mask 255.255.255.0 notrust


# If you want to provide time to your local subnet, change the next line.
# (Again, the address is an example only.)
#broadcast 192.168.123.255

# If you want to listen to time broadcasts on your local subnet, de-comment the
# next lines.  Please do this only if you trust everybody on the network!
#disable auth
#broadcastclient
</code></pre></div>

<p>If needed, you can change the ntp servers to the ntp servers you want to use.</p>
<p>Review the configuration and you will see cool things like giving the ntp service to other computers although you do not need it for passing LPIC.</p>
<h4>ntpq</h4>
<p>The <code>ntpq</code> queries the ntp service. One famous switch is <code>-p</code> (for Print) that shows the pool we are using to sync the clock:</p>
<div class="highlight"><pre><span></span><code> ntpq -p
     remote           refid      st t when poll reach   delay   offset  jitter
==============================================================================
 0.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000
 1.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000
 2.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000
 3.debian.pool.n .POOL.          16 p    -   64    0    0.000    0.000   0.000
+46.209.14.1     192.168.5.2      4 u    7   64    1   58.300  -15.546  14.519
-ntp.tums.ac.ir  195.161.115.4    4 u    4   64    1   30.636    2.485   4.025
*194.225.150.25  194.190.168.1    2 u    5   64    1   31.478   -3.870  95.635
+5.160.24.41     192.168.5.2      4 u    3   64    1   90.000  -28.328  21.643
</code></pre></div>

<p>In this output a <code>*</code> means that the ntp is using this server as the main reference, <code>+</code> means that this is a good server and <code>-</code> shows an out of range server which will be neglected.</p>


             
 
            
            
            







            <hr/>

            <!-- show next and previous links -->
            <table style="background: white; border: 0; font-size: 0.8em;"><tr>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <td style="background: white; border: 0;">
                            <a href="./1073-localisation-and-internationalisation.html">← 107.3 Localisation and internationalisation</a>
                </td>
                <td style="background: white; border: 0;"><center ><a href="/archives.html">Chapter List</a></center></td>
                <td style="background: white; border: 0; text-align: right;">
                            <a href="./1082-system-logging.html">108.2 System logging →</a>
                </td>
                
                
                
                
                
                
                
                
                
                
            </tr></table>
            
            <hr />


	<div class=comment>

<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://linux1st.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


	</div>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#lpic1-ref">LPIC1</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#102-ref">102
                    <span class="superscript">20</span>
</a></li>
                <li><a href="./tags.html#lpic1-ref">LPIC1
                    <span class="superscript">42</span>
</a></li>
                <li><a href="./tags.html#lpic1-102-500-ref">LPIC1-102-500
                    <span class="superscript">20</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>