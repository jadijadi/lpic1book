<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Jadi" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="LPIC1, 102, LPIC1-102-500, LPIC1, " />

<meta property="og:title" content="110.2 Setup host security "/>
<meta property="og:url" content="./1102-setup-host-security.html" />
<meta property="og:description" content="" />
<meta property="og:site_name" content="lpic1book" />
<meta property="og:article:author" content="Jadi" />
<meta property="og:article:published_time" content="2010-12-03T10:20:00+01:00" />
<meta name="twitter:title" content="110.2 Setup host security ">
<meta name="twitter:description" content="">

        <title>110.2 Setup host security  · lpic1book
</title>



        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-4CZV14VZXW"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-4CZV14VZXW');
        </script>
        
    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>lpic1book</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                </li>
                                <li ><a href="./">Home</a></li>
                                <li ><a href="./support">Support/Donate</a></li>
                                <li ><a href="./archives.html">Chapters</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li><form action="https://www.google.com/search" method="get" target="_blank" class="navbar-search"> <input type="hidden" name="sitesearch" value="https://linux1st.com/"/><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./1102-setup-host-security.html">
                110.2 Setup host security
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p><em>Weight: 3</em></p>
<p>Candidates should know how to set up a basic level of host security.</p>
<h3>Key Knowledge Areas</h3>
<ul>
<li>Awareness of shadow passwords and how they work.</li>
<li>Turn off network services not in use.</li>
<li>Understand the role of TCP wrappers.</li>
</ul>
<h3>Terms and Utilities</h3>
<ul>
<li>/etc/nologin</li>
<li>/etc/passwd</li>
<li>/etc/shadow</li>
<li>/etc/xinetd.d/</li>
<li>/etc/xinetd.conf</li>
<li>systemd.socket</li>
<li>/etc/inittab</li>
<li>/etc/init.d/</li>
<li>/etc/hosts.allow</li>
<li>/etc/hosts.deny</li>
</ul>
<h4>shadow passwords</h4>
<p>The <code>/dev/passwd</code> is already discussed. It contains the passwords of the users but there is a logical problem: if a user should be able to change her own password, he should have access to this file and if this is the case, he can see other people's passwords. This is not interesting even when the passwords are hashed (shown as a more complex form using a one way function).</p>
<div class="highlight"><pre><span></span><code>$ ls -ltrh /etc/passwd
-rw-r--r-- 1 root root 2.5K Jun  5 19:14 /etc/passwd
</code></pre></div>

<p>To prevent this the <code>/etc/shadow</code> file is introduces. In modern systems, we only show a <code>*</code> at the location of the password in /etc/passwd and store the real password in <code>/etc/shadow</code> which has a very limited file access:</p>
<div class="highlight"><pre><span></span><code>jadi@funlife ~$ grep jadi /etc/passwd
jadi:x:1000:1000:jadi,,,:/home/jadi:/bin/bash
jadi@funlife ~$ grep jadi /etc/shadow
grep: /etc/shadow: Permission denied
jadi@funlife ~$ sudo grep jadi /etc/shadow
[sudo] password for jadi:
jadi:$6$bp01DBX.$I6dt4pz8GeXJl6asgPeKhSdepf40bgepTz8zwB3HFmN56SdcsxjTETdZAmRt17biwMYOI7SoGFOXssHqeNFgw/:16963:0:99999:7:::
jadi@funlife ~$ sudo ls -ltrh /etc/shadow
-rw-r----- 1 root shadow 1.5K Jun 11 17:36 /etc/shadow
</code></pre></div>

<h4>/etc/nologin</h4>
<p>This is a cool file! If you create and write something in it, the content will be shown to any person who tries to login into the system and the login attempt will fail. It is useful for maintenance time. Delete this file and the users will be able to login again.</p>
<blockquote>
<p>the root user will be able to login even in the presence of /etc/nologin</p>
</blockquote>
<p>Please also note that there a is dummy shell called <code>nologin</code> and you can set it as shell for any user you want to prevent from being able to login into the system via a shell. Note that such a user still has an active account and will be able to use other services (say email or ftp) but wont be able to enter the shell. </p>
<div class="highlight"><pre><span></span><code>sudo usermod -s /sbin/nologin baduser
</code></pre></div>

<h3>super-servers</h3>
<p>A super-server or sometimes called a service dispatcher is a type of daemon running mostly on Unix-like systems for security and resource management reasons. It listens for requests its configured for and starts the target services when needed to answer the requests. This adds a layer of security to your communications and also lets some of the services to be inactive when we do not need them. You can see a super server or superdaemon as a TCP (and UDP or even ICMP) wrapper around other services.</p>
<p><img alt="Super Server" src="/images/super-server.png"></p>
<p>Few GNU/Linuxes use TCP wrappers like <code>xinetd</code> these days but you might see it in some installations or traces of it in your <code>/etc/xinet.d</code>. If needed it is also possible to configure the <code>systemd.socket</code> as a TCP wrapper for other services. </p>
<p>Here is a sample xinetd configuration file:</p>
<div class="highlight"><pre><span></span><code>service telnet
{
        disable         = no
        flags           = REUSE
        socket_type     = stream
        wait            = no
        user            = root
        server          = /usr/sbin/in.telnetd
        log_on_failure  += USERID
        no_access       = 10.0.1.0/24
        log_on_success  += PID HOST EXIT
        access_times    = 09:45-16:15
}
</code></pre></div>

<p>If we change the <code>disable</code> to <code>yes</code> and restart the xinetd, the telnet daemon will start running. There are a few files to control to xinetd related files.</p>
<p>As mentioned, <code>xinetd</code> is replaced by the <code>systemd.socket</code> units. Some of the services like ssh and cups might have a socket unit alongside the service unit in your distribution. In this case its enough to stop &amp; disable the <code>ssh.service</code> and start the <code>ssh.docekt</code> instead. Now the systemd.socekt is acting as a warpper around the port 22 and IF someones needs the service, starts the ssh server to answer. </p>
<h3>Removing unused services</h3>
<p>Based on your distribution, you can check the running services using the <code>service</code> or <code>systemctl</code> command. If you are using the SysV init system (older distros mainly) or you have the compatibility tools installed, do as follow:</p>
<div class="highlight"><pre><span></span><code>~ sudo service --status-all
 [ - ]  alsa-utils
 ....
 [ + ]  ufw
 [ + ]  unattended-upgrades
 [ + ]  uuidd
 [ + ]  vpn-unlimited-daemon
 [ + ]  vsftpd
 [ - ]  whoopsie
 [ - ]  x11-common
</code></pre></div>

<p>On a RedHat based machine, you can stop a service via:</p>
<div class="highlight"><pre><span></span><code>sudo chkconfig vsfptd off
</code></pre></div>

<p>and On debian machines:</p>
<div class="highlight"><pre><span></span><code>sudo update-rc.d vsftpd remove
</code></pre></div>

<p>If you are using the systemd, do as follow to check and stop / disable a service:</p>
<div class="highlight"><pre><span></span><code>systemctl list-units --state active --type service
systemctl status
systemctl disable vsftpd.service --now
</code></pre></div>

<p>Please also remember than on older systems, we used to have all the Init scripts in <code>/etc/init.d</code> and <code>/etc/rcX.d</code> folders. There were also a <code>/etc/inittab</code> file which was a configuration file for initializing a Linux system using SysV. I contains lines i this format:</p>
<div class="highlight"><pre><span></span><code><span class="n">id</span><span class="o">:</span><span class="n">runlevel</span><span class="o">:</span><span class="n">action</span><span class="o">:</span><span class="n">process</span>
</code></pre></div>

<p>This would tell the init system to do <code>actions</code> on the <code>process</code> on a specific <code>runlevel</code>. For example:</p>
<div class="highlight"><pre><span></span><code><span class="mi">1</span><span class="o">:</span><span class="mi">2345</span><span class="o">:</span><span class="n">respawn</span><span class="o">:/</span><span class="n">sbin</span><span class="o">/</span><span class="n">mingetty</span><span class="w"> </span><span class="n">tty1</span>
</code></pre></div>

<p>tells the init to start (and respawn if killed), the <code>mingetty tty1</code> command on runlevels 2, 3, 4, &amp; 5. As the final note, this was the most important line in the <code>inittab</code> file because it told the init to start in run level 3. </p>
<div class="highlight"><pre><span></span><code><span class="n">id</span><span class="o">:</span><span class="mi">3</span><span class="o">:</span><span class="n">initdefault</span><span class="o">:</span>
</code></pre></div>

<p>for more information about runlevels, please refer to <a href="1013-change-runlevels-boot-targets-and-shutdown-or-reboot-the-system.html">Chapter 101.3</a>.</p>
<h4>/etc/hosts.allow &amp; /etc/hosts.deny</h4>
<p>These two files will allow or deny access from specific hosts. Its logic is like cron.deny and cron.allow. If something is allowed, everything else is denied but if you add something to the /etc/hosts.deny, only that specific thing is denied (and every other thing is allowed).</p>
<div class="highlight"><pre><span></span><code>jadi@funlife ~$ cat /etc/hosts.allow
# /etc/hosts.allow: list of hosts that are allowed to access the system.
#                   See the manual pages hosts_access(5) and hosts_options(5).
#
# Example:    ALL: LOCAL @some_netgroup
#             ALL: .foobar.edu EXCEPT terminalserver.foobar.edu
#
# If you&#39;re going to protect the portmapper use the name &quot;rpcbind&quot; for the
# daemon name. See rpcbind(8) and rpc.mountd(8) for further information.
#

vsftpd: 10.10.100.
</code></pre></div>

<p>How the <code>vsftpd</code> knows about this file? Because it uses the <code>libwrap</code> library in its source and the libwrap understands the wrapper tools. You can check this claim by searching for <code>libwrap</code> in the list of libraries <code>vsftpd</code> uses:</p>
<div class="highlight"><pre><span></span><code>➜  ~ ldd /usr/sbin/vsftpd | grep libwrap
    libwrap.so.0 =&gt; /lib/x86_64-linux-gnu/libwrap.so.0 (0x00007fb293921000)
</code></pre></div>

<p>Here the <code>vsftpd</code> service is only allowed from 10.10.100.* . It is possible to use <code>ALL</code> as the service name to allow or deny ALL services.</p>
<blockquote>
<p>after changing this file, xinetd should be restarted</p>
</blockquote>
<p>As mentioned, super servers are not being used anymore and most distributions use standalone services. </p>


             
 
            
            
            







            <hr/>

            <!-- show next and previous links -->
            <table style="background: white; border: 0; font-size: 0.8em;"><tr>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <td style="background: white; border: 0;">
                            <a href="./1101-perform-security-administration-tasks.html">← 110.1 Perform security administration tasks</a>
                </td>
                <td style="background: white; border: 0;"><center ><a href="/archives.html">Chapter List</a></center></td>
                <td style="background: white; border: 0; text-align: right;">
                            <a href="./1103-securing-data-with-encryption.html">110.3 Securing data with encryption →</a>
                </td>
                
            </tr></table>
            
            <hr />


	<div class=comment>

<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://linux1st.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


	</div>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#lpic1-ref">LPIC1</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#102-ref">102
                    <span class="superscript">20</span>
</a></li>
                <li><a href="./tags.html#lpic1-ref">LPIC1
                    <span class="superscript">42</span>
</a></li>
                <li><a href="./tags.html#lpic1-102-500-ref">LPIC1-102-500
                    <span class="superscript">20</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>