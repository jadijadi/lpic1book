<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Jadi" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="LPIC1, 101, LPIC1-101-500, LPIC1, " />

<meta property="og:title" content="104.5 Manage file permissions and ownership "/>
<meta property="og:url" content="./1045-manage-file-permissions-and-ownership.html" />
<meta property="og:description" content="" />
<meta property="og:site_name" content="lpic1book" />
<meta property="og:article:author" content="Jadi" />
<meta property="og:article:published_time" content="2010-12-03T10:20:00+01:00" />
<meta name="twitter:title" content="104.5 Manage file permissions and ownership ">
<meta name="twitter:description" content="">

        <title>104.5 Manage file permissions and ownership  · lpic1book
</title>



        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-4CZV14VZXW"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-4CZV14VZXW');
        </script>
        
    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>lpic1book</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                </li>
                                <li ><a href="./">Home</a></li>
                                <li ><a href="./support">Support/Donate</a></li>
                                <li ><a href="./archives.html">Chapters</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li><form action="https://www.google.com/search" method="get" target="_blank" class="navbar-search"> <input type="hidden" name="sitesearch" value="https://linux1st.com/"/><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./1045-manage-file-permissions-and-ownership.html">
                104.5 Manage file permissions and ownership
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p><em>Weight: 3</em></p>
<p>Candidates should be able to control file access through the proper use of permissions and ownerships.</p>
<h3>Key Knowledge Areas</h3>
<ul>
<li>Manage access permissions on regular and special files as well as directories.</li>
<li>Use access modes such as suid, sgid and the sticky bit to maintain security.</li>
<li>Know how to change the file creation mask.</li>
<li>
<p>Use the group field to grant file access to group members.</p>
</li>
<li>
<p>chmod</p>
</li>
<li>umask</li>
<li>chown</li>
<li>chgrp</li>
</ul>
<h2>Users and Groups</h2>
<p>A linux system can have many users and many groups. You can login with one user and use <code>su</code> command to change to another group. Each user belongs to one primary group and can be a member of other groups too.</p>
<p>To check your user and group use the <code>whoami</code>, <code>groups</code> and <code>id</code> commands.</p>
<div class="highlight"><pre><span></span><code>- $ whoami
jadi
- $ groups
jadi adm cdrom sudo dip plugdev netdev lpadmin sambashare debian-tor
- $ id
uid=1000(jadi) gid=1000(jadi) groups=1000(jadi),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),102(netdev),108(lpadmin),124(sambashare),125(debian-tor)
- $ su root -
Password:
- # id
uid=0(root) gid=0(root) groups=0(root)
- # exit
exit
- $ whoami
jadi
</code></pre></div>

<p>As you can see <code>id</code> shows both user and group information.</p>
<blockquote>
<p>Note the 0 UID and 0 GID of the root user and root group.</p>
</blockquote>
<p>These are stored in <code>/etc/passwd</code> and <code>/etc/group</code> files.</p>
<div class="highlight"><pre><span></span><code>$ cat /etc/group | grep adm
adm:x:4:syslog,jadi
lpadmin:x:108:jadi
</code></pre></div>

<h2>File ownership &amp; permissions</h2>
<p>Linux uses three layers of access/permissions for each file or directory: User, Group &amp; Others.</p>
<p>Each file belongs to one user and one group and this user and the members of that group will have specific read/write/execute accesses on it. Have a look:</p>
<div class="highlight"><pre><span></span><code>$ ls -ltrh script.sh
-rwxr-xr-x 1 jadi adm 34 Mar  5  2023 script.sh
</code></pre></div>

<p>In above example, <code>jadi</code> is the owner of the file. The file belongs to the <code>adm</code> group and the owner (<code>jadi</code> here) has  <strong>r</strong>ead, <strong>w</strong>rite (including deletion and edit) &amp; <strong>e</strong>xecute (reading directory content) permissions on the file while the <code>adm</code> group members and <strong>others</strong> only have read &amp; execute access.</p>
<p><img alt="" src="/images/file_permissions.png"></p>
<blockquote>
<p>In many distros, when you create a user, the system creates a group with the same name and assigns that user's files to that group.</p>
</blockquote>
<p>The below table shows some more information regarding the first part of the <code>ls -l</code> command:</p>
<table>
<thead>
<tr>
<th align="center">Position</th>
<th align="center">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">1</td>
<td align="center">What this entry is. Dash (-) is for ordinary files, 'l' is for links &amp; 'd' is for directory</td>
</tr>
<tr>
<td align="center">2,3,4</td>
<td align="center">read, write and execute access for the owner</td>
</tr>
<tr>
<td align="center">5,6,7</td>
<td align="center">read, write and execute access for the group members</td>
</tr>
<tr>
<td align="center">8,9,10</td>
<td align="center">read, write and execute access for other users</td>
</tr>
<tr>
<td align="center">11</td>
<td align="center">Indicated if any other access methods (such as SELinux) are applies to this file - not part of the LPIC 101 exam</td>
</tr>
</tbody>
</table>
<p>Lets check another example.</p>
<div class="highlight"><pre><span></span><code>$ ls -l /sbin/fdisk
-rwxr-xr-x 1 root root 267176 Oct 15 18:58 /sbin/fdisk
</code></pre></div>

<p>We can see that the <code>fdisk</code> can be read, be written and be executed by its owner (root). Other users (even if they belong to the group <code>root</code>) can only read and execute it.</p>
<blockquote>
<p>although non-root users can execute the fdisk, this program wont do much if it sees that a non root user is running it.</p>
</blockquote>
<p>Lets look at another example:</p>
<div class="highlight"><pre><span></span><code>$ ls -l /home/
total 12
drwxr-xr-x 160 jadi jadi 12288 Feb  7 11:44 jadi
</code></pre></div>

<p>The first character is a <code>d</code> so this is a directory. The owner (<code>jadi</code>) has read, write and execute access but other members of the <code>jadi</code> <strong>group</strong> and <strong>others</strong> only have read and execute access on this directory.</p>
<p>execute (<code>x</code> character) means that they can see the files inside it, have a look if dir has not <code>x</code>:</p>
<div class="highlight"><pre><span></span><code>(with root user)
$ tree /tmp/FOO
FOO
├── Bar1
└── Bar2

$ ls -ld /tmp/FOO/
drw-r--r--. 2 jadi jadi 80 Mar 23 19:32 FOO/

(With other user)
$ ls -l FOO/
ls: cannot access &#39;FOO/Bar2&#39;: Permission denied
ls: cannot access &#39;FOO/Bar1&#39;: Permission denied
total 0
-????????? ? ? ? ?            ? Bar1
-????????? ? ? ? ?            ? Bar2
</code></pre></div>

<h3>Changing permissions</h3>
<p>It is possible to change the permissions on files &amp; directories using the <code>chmod</code> command. There are two ways to tell this command what you want to do:</p>
<ol>
<li>using octal (base 8) codes</li>
<li>using short codes </li>
</ol>
<p>When using octal codes, you have to to create an octal number to tell chmod what you want to do. In this method, <code>0</code> means no access, <code>1</code> means execute, <code>2</code> means write and <code>4</code> means read. So if you want to give <strong><em>read</em></strong>+<strong><em>execute</em></strong>, you have to give <code>4</code>+<code>1</code> which is <code>5</code>. The below table shows every possible combination:</p>
<table>
<thead>
<tr>
<th align="center">Symbolic</th>
<th align="center">Octal</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">rwx</td>
<td align="center">7</td>
</tr>
<tr>
<td align="center">rw-</td>
<td align="center">6</td>
</tr>
<tr>
<td align="center">r-x</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">r--</td>
<td align="center">4</td>
</tr>
<tr>
<td align="center">-wx</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">-w-</td>
<td align="center">2</td>
</tr>
<tr>
<td align="center">--x</td>
<td align="center">1</td>
</tr>
<tr>
<td align="center">---</td>
<td align="center">0</td>
</tr>
</tbody>
</table>
<p>So if you want to give <code>rwx</code> to the owner, <code>rx</code> to the group and only <code>x</code> to others, you have to use <code>751</code>:</p>
<div class="highlight"><pre><span></span><code>$ ls -ltrh myfile
-rw-rw-r-- 1 jadi jadi 0 Feb  8 21:01 myfile
$ chmod 751 myfile
$ ls -ltrh myfile
-rwxr-x--x 1 jadi jadi 0 Feb  8 21:01 myfile
</code></pre></div>

<p>This might look difficult but there are some commonly used combinations like <code>755</code> for general executable files or <code>600</code> for personal files.</p>
<p>There is also an <em>easier</em> method. In this method <code>u</code> means user, <code>g</code> means group and <code>o</code> means others. You can append <code>+x</code> to give execute permission, <code>+r</code> to give read permission and <code>+w</code> to give write permission. For example <code>u+x</code> will grant execute permission to user. If you want to remove a permission, use a <code>-</code> sign. For example <code>g-r</code> to prevent <code>group</code> members from <code>read</code>ing the file.</p>
<div class="highlight"><pre><span></span><code>$ ls -ltrh myfile
-rwxr-x--x 1 jadi jadi 0 Feb  8 21:01 myfile
$ chmod u-x myfile
$ ls -ltrh myfile
-rw-r-x--x 1 jadi jadi 0 Feb  8 21:01 myfile
$ chmod +x myfile
$ chmod uo+xr myfile
$ ls -ltrh myfile
-rwxr-xr-x 1 jadi jadi 0 Feb  8 21:01 myfile
</code></pre></div>

<p>One very common switch on <code>chmod</code> is <code>-R</code> for recursive <code>chmod</code>ing on files. This will give <code>read</code> permission of all files inside /tmp/ to any user:</p>
<div class="highlight"><pre><span></span><code># chmod -R o+r /tmp
</code></pre></div>

<h3>Changing owner and groups</h3>
<p>If you need to change the ownership or group of a file or directory, use the <code>chown</code> command:</p>
<div class="highlight"><pre><span></span><code>$ ls -ltrh newfile
-rw-rw-r-- 1 jadi jadi 0 Feb  8 21:38 newfile
$ chown root:root newfile
chown: changing ownership of ‘newfile’: Operation not permitted
$ sudo chown root:root newfile
[sudo] password for jadi:
$ ls -ltrh newfile
-rw-rw-r-- 1 root root 0 Feb  8 21:38 newfile
</code></pre></div>

<p>A common switch is <code>-R</code> to <code>chown</code> recursively.</p>
<p>If need to only change the group you may use <code>chgrp</code> command:</p>
<div class="highlight"><pre><span></span><code>$ sudo chgrp postgres newfile
$ ls -ltrh newfile
-rw-rw-r-- 1 root postgres 0 Feb  8 21:38 newfile
</code></pre></div>

<p>It is possible to assign more groups to a user via <code>usermod</code> command:</p>
<div class="highlight"><pre><span></span><code>$<span class="w"> </span>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>sudo<span class="w"> </span>jadi<span class="w"> </span><span class="c1"># will add jadi to the sudo group</span>
</code></pre></div>

<p>Since users can be a member of many groups, they might need to change their <strong>default group</strong> when creating files. To do so, check the groups with <code>groups</code> command and set the default one with <code>newgrp</code>:</p>
<div class="highlight"><pre><span></span><code>$ touch newfile
$ ls -ltrh newfile
-rw------- 1 jadi jadi 0 Feb  8 21:53 newfile
$ groups
jadi adm cdrom sudo dip plugdev netdev lpadmin sambashare debian-tor
$ newgrp adm
$ touch newerfile
$ ls -ltrh new*
-rw------- 1 jadi jadi 0 Feb  8 21:53 newfile
-rw------- 1 jadi adm  0 Feb  8 21:54 newerfile
</code></pre></div>

<h2>Access modes</h2>
<p>A question for you: If we do not have write access to <code>/etc/passwd</code> or <code>/etc/shadow</code>, how is it possible to change our password then?</p>
<p>Normally when you run a program, it runs with <em>your</em> access level. But what happens if you need to run a program with a higher access level? say to do changes in the password files? For this Linux sets two special bits for each file; <strong>suid</strong> (set user id) and <strong>sgid</strong> (set group id). If these bits are set on a file, that file will be executed with the access of the <strong>owner</strong> (or <strong>group</strong>) of the file and not the user who is running it.</p>
<div class="highlight"><pre><span></span><code>$ ls -ltrh /usr/bin/passwd
-rwsr-xr-x 1 root root 50K Jul 18  2014 /usr/bin/passwd
</code></pre></div>

<p>Kindly note the <code>s</code> in the <em>executable bit</em> for the user permissions and also for the group? That means when any user runs this program, it will be run with the owner of the file access level (which is root) instead of that user's id.</p>
<p>It is possible to set/unset the <code>suid</code> and <code>sgid</code> using <code>chmod</code> and <code>+s</code> or <code>-s</code> instead of <code>x</code>.</p>
<p>While we are on this, let me introduce you to the last special bit. It is called <strong>sticky bit</strong> and if set, makes the file resistant to <strong><em>deletion</em></strong>. If the sticky bit is set, ONLY the owner of the file will be able to delete it, even if others do have write access to it. This is useful for places like /tmp (everybody has write access on /tmp directory but we do not want others to delete our files).</p>
<p>Sticky bit is identified by <code>t</code> and will be shown on the last bit of a <code>ls -l</code>:</p>
<div class="highlight"><pre><span></span><code>$ ls -dl /tmp
drwxrwxrwt 13 root root 77824 Feb  8 21:27 /tmp
</code></pre></div>

<p>As you can see the sticky bit is set and although all users have write access in this directory, they wont be able to delete each others files.</p>
<p>Lets review how you can set these access modes:</p>
<table>
<thead>
<tr>
<th align="center">access mode</th>
<th align="center">octal</th>
<th align="center">symbolic</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">suid</td>
<td align="center">4000</td>
<td align="center">u+s</td>
</tr>
<tr>
<td align="center">sgid</td>
<td align="center">2000</td>
<td align="center">g+s</td>
</tr>
<tr>
<td align="center">sticky</td>
<td align="center">1000</td>
<td align="center">+t</td>
</tr>
</tbody>
</table>
<blockquote>
<p>guid on a directory will force any new file in that directory to have the guid of the directory itself.</p>
</blockquote>
<h2>umask</h2>
<p>Another tricky question: what is the permissions of a newly created file? What happens if you <code>touch</code> a non-existing file? What will be its permissions? This is set by the <code>umask</code>. This command tells the system what permissions (in addition to execute) <strong>should not be given to</strong> new files. In other words, imagine that all new files will have <code>666</code> octal permission (write + read for user, group &amp; others), so a umask of 0002 (yes! 4 digits) will remove the 2 (write) for others (666-0002=664):</p>
<div class="highlight"><pre><span></span><code>$ umask
0002
</code></pre></div>

<p>If we need to change umask, it can be done with the same command:</p>
<div class="highlight"><pre><span></span><code>$ umask
0002
$ touch newfile
$ ls -ltrh newfile
-rw-rw-r-- 1 jadi jadi 0 Feb  8 21:38 newfile
$ mkdir newdir
$ ls -ltrhd newdir
drwxrwxr-x 2 jadi jadi 4.0K Feb  8 21:38 newdir
$ umask u=rw,g=,o=
$ touch newerfile
$ ls -l newerfile
-rw------- 1 jadi jadi 0 Feb  8 21:41 newerfile
$ umask
0177
</code></pre></div>

<blockquote>
<p>Note how I used <code>u=rw,g=,o=</code> to tell <code>umask</code> or <code>chmod</code> what I exactly wanted from it.</p>
</blockquote>


             
 
            
            
            







            <hr/>

            <!-- show next and previous links -->
            <table style="background: white; border: 0; font-size: 0.8em;"><tr>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <td style="background: white; border: 0;">
                            <a href="./1044-removed.html">← 104.4 Removed</a>
                </td>
                <td style="background: white; border: 0;"><center ><a href="/archives.html">Chapter List</a></center></td>
                <td style="background: white; border: 0; text-align: right;">
                            <a href="./1046-create-and-change-hard-and-symbolic-links.html">104.6 Create and change hard and symbolic links →</a>
                </td>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
            </tr></table>
            
            <hr />


	<div class=comment>

<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://linux1st.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


	</div>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#lpic1-ref">LPIC1</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#101-ref">101
                    <span class="superscript">19</span>
</a></li>
                <li><a href="./tags.html#lpic1-ref">LPIC1
                    <span class="superscript">42</span>
</a></li>
                <li><a href="./tags.html#lpic1-101-500-ref">LPIC1-101-500
                    <span class="superscript">22</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>