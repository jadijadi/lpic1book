<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" type="text/css" href="./theme/css/elegant.prod.9e9d5ce754.css" media="screen">
        <link rel="stylesheet" type="text/css" href="./theme/css/custom.css" media="screen">

        <link rel="dns-prefetch" href="//fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin>

        <meta name="author" content="Jadi" />

        <meta property="og:type" content="article" />
        <meta name="twitter:card" content="summary">

<meta name="keywords" content="LPIC1, 102, LPIC1-102-500, LPIC1, " />

<meta property="og:title" content="108.2 System logging "/>
<meta property="og:url" content="./1082-system-logging.html" />
<meta property="og:description" content="" />
<meta property="og:site_name" content="lpic1book" />
<meta property="og:article:author" content="Jadi" />
<meta property="og:article:published_time" content="2010-12-03T10:20:00+01:00" />
<meta name="twitter:title" content="108.2 System logging ">
<meta name="twitter:description" content="">

        <title>108.2 System logging  · lpic1book
</title>



        
        <!-- Global site tag (gtag.js) - Google Analytics -->
        <script async src="https://www.googletagmanager.com/gtag/js?id=G-4CZV14VZXW"></script>
        <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-4CZV14VZXW');
        </script>
        
    </head>
    <body>
        <div id="content">
            <div class="navbar navbar-static-top">
                <div class="navbar-inner">
                    <div class="container-fluid">
                        <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                            <span class="icon-bar"></span>
                        </a>
                        <a class="brand" href="./"><span class=site-name>lpic1book</span></a>
                        <div class="nav-collapse collapse">
                            <ul class="nav pull-right top-menu">
                                <li >
                                </li>
                                <li ><a href="./">LPIC1 Book</a></li>
                                <li ><a href="./">Home</a></li>
                                <li ><a href="./support">Support/Donate</a></li>
                                <li ><a href="./archives.html">Chapters</a></li>
                                <li ><a href="./tags.html">Tags</a></li>
                                <li><form action="https://www.google.com/search" method="get" target="_blank" class="navbar-search"> <input type="hidden" name="sitesearch" value="https://linux1st.com/"/><input type="text" class="search-query" placeholder="Search" name="q" id="tipue_search_input"></form></li>

                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container-fluid">
                <div class="row-fluid">
                    <div class="span1"></div>
                    <div class="span10">
<article itemscope>
<div class="row-fluid">
    <header class="page-header span10 offset2">
        <h1>
            <a href="./1082-system-logging.html">
                108.2 System logging
            </a>
        </h1>
    </header>
</div>

<div class="row-fluid">
        <div class="span8 offset2 article-content">
            
            <p><em>Weight: 4</em></p>
<p>Candidates should be able to configure rsyslog. This objective also includes configuring the logging daemon to send log output to a central log server or accept log output as a central log server. Use of the systemd journal subsystem is covered. Also, awareness of syslog and syslog-ng as alternative logging systems is included.</p>
<h3>Key Knowledge Areas</h3>
<ul>
<li>Basic configuration of rsyslog.</li>
<li>Understanding of standard facilities, priorities and actions.</li>
<li>Query the systemd journal.</li>
<li>Filter systemd journal data by criteria such as date, service or priority.</li>
<li>Configure persistent systemd journal storage and journal size.</li>
<li>Delete old systemd journal data.</li>
<li>Retrieve systemd journal data from a rescue system or file system copy.</li>
<li>Understand interaction of rsyslog with systemd-journald.</li>
<li>Configuration of logrotate.</li>
<li>Awareness of syslog and syslog-ng.</li>
</ul>
<h3>Terms and Utilities</h3>
<ul>
<li><code>/etc/rsyslog.conf</code></li>
<li><code>/var/log/</code></li>
<li><code>logger</code></li>
<li><code>logrotate</code></li>
<li><code>/etc/logrotate.conf</code></li>
<li><code>/etc/logrotate.d/</code></li>
<li><code>journalctl</code></li>
<li><code>systemd-cat</code></li>
<li><code>/etc/systemd/journald.conf</code></li>
<li><code>/var/log/journal/</code></li>
</ul>
<iframe width="560" height="315" src="https://www.youtube.com/embed/qtHTf6q_UaI" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<h3>History</h3>
<p>Logs are an important part of Unix philosophy and design. The Kernel, services, programs and most events (let it be a crash or a login attempt) will generate logs. These logs can be examines / monitored to gain insights about the system and its status. If you watch a Linux guy on a windows machine for 1 hour, you will hear "where are the logs?". </p>
<p>If every single program tries to handle its own logs we will face 2 issues (at least!); 1. programming will be difficult because you need to invent (or import) the wheel and 2. different programmers will generate different kinds, formats and location for their logs and it will be difficult to keep them  under your control. To overcome this, Unix world had its own solution: central logging service.</p>
<p>The older utility to manage logs was called <code>syslog</code>, then we had <code>syslog-ng</code> (new-generation) and later <code>rsyslog</code> which is what most distros were using till a couple of years ago. <code>rsyslog</code> is still present and is part of the GNU/Linux universe. It can receive logs from different programs (even over network) and save them in different places (files or files in network or even run some actions on them). It's logs are saved in the text format and can be managed by the tool of your choice, let it be <code>grep</code>, <code>less</code>, <code>tail</code>, <code>zless</code> (less a compressed file without explicitly opening it), <code>zcat</code> (catting a file without explicitly opening it), <code>grep</code>, ....</p>
<p>But these days <code>systemd</code> is conquering most of the linux world and logs are not an exception. SystemDs logging service is called <code>journald</code> and we use the <code>journalctl</code>  command to read its logs; unfortunately they are not text files anymore.</p>
<p>You should also know about a couple of other tools (like <code>logrotate</code> to cleanup the older logs) and be familiar with some of more important system logs under GNU/Linux. So lets start.</p>
<blockquote>
<p>Its fun to know how the logs work in more depth. Here it is: whoever wants to log something eventually sends its messages to the <code>/dev/log</code> or  <code>/dev/kmsg</code> devices (often by using a helper tool). The logging tool (say <code>rsyslog</code>) will read from these devices and process the logs based on its configs; and now, the messages are logs!</p>
</blockquote>
<h2>dmesg</h2>
<p>As I told you, Linux loves logs and will be happy logging everything. But what about the boot process? What happens if the kernel wants to log something before the disks are ready? These logs are saved by the Kernel in the <em>Kernel Ring Buffer</em>. You can access it using the <code>dmesg</code> command. </p>
<h2>log rotation</h2>
<p>So logs are being generated and saved! Someone need to clean them up to prevent the disk from getting full. The <code>logrotate</code> utility takes care of this task.  The main configuration is at <code>/etc/logrotate.conf</code>:</p>
<div class="highlight"><pre><span></span><code><span class="nx">root</span><span class="err">@</span><span class="nx">debian</span><span class="p">:</span><span class="err">#</span><span class="w"> </span><span class="nx">cat</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">logrotate</span><span class="p">.</span><span class="nx">conf</span>
<span class="err">#</span><span class="w"> </span><span class="nx">see</span><span class="w"> </span><span class="s">&quot;man logrotate&quot;</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="nx">details</span>

<span class="err">#</span><span class="w"> </span><span class="nx">global</span><span class="w"> </span><span class="nx">options</span><span class="w"> </span><span class="nx">do</span><span class="w"> </span><span class="k">not</span><span class="w"> </span><span class="nx">affect</span><span class="w"> </span><span class="nx">preceding</span><span class="w"> </span><span class="nx">include</span><span class="w"> </span><span class="nx">directives</span>

<span class="err">#</span><span class="w"> </span><span class="nx">rotate</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">weekly</span>
<span class="nx">weekly</span>

<span class="err">#</span><span class="w"> </span><span class="nx">keep</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="nx">weeks</span><span class="w"> </span><span class="nx">worth</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">backlogs</span>
<span class="nx">rotate</span><span class="w"> </span><span class="mi">4</span>

<span class="err">#</span><span class="w"> </span><span class="nx">create</span><span class="w"> </span><span class="nx">new</span><span class="w"> </span><span class="p">(</span><span class="nx">empty</span><span class="p">)</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">after</span><span class="w"> </span><span class="nx">rotating</span><span class="w"> </span><span class="nx">old</span><span class="w"> </span><span class="nx">ones</span>
<span class="nx">create</span>

<span class="err">#</span><span class="w"> </span><span class="nx">use</span><span class="w"> </span><span class="nx">date</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="nx">suffix</span><span class="w"> </span><span class="nx">of</span><span class="w"> </span><span class="nx">the</span><span class="w"> </span><span class="nx">rotated</span><span class="w"> </span><span class="nx">file</span>
<span class="err">#</span><span class="nx">dateext</span>

<span class="err">#</span><span class="w"> </span><span class="nx">uncomment</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nx">you</span><span class="w"> </span><span class="nx">want</span><span class="w"> </span><span class="nx">your</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="nx">files</span><span class="w"> </span><span class="nx">compressed</span>
<span class="err">#</span><span class="nx">compress</span>

<span class="err">#</span><span class="w"> </span><span class="nx">packages</span><span class="w"> </span><span class="nx">drop</span><span class="w"> </span><span class="nx">log</span><span class="w"> </span><span class="nx">rotation</span><span class="w"> </span><span class="nx">information</span><span class="w"> </span><span class="nx">into</span><span class="w"> </span><span class="nx">this</span><span class="w"> </span><span class="nx">directory</span>
<span class="nx">include</span><span class="w"> </span><span class="o">/</span><span class="nx">etc</span><span class="o">/</span><span class="nx">logrotate</span><span class="p">.</span><span class="nx">d</span>

<span class="err">#</span><span class="w"> </span><span class="nx">system</span><span class="o">-</span><span class="nx">specific</span><span class="w"> </span><span class="nx">logs</span><span class="w"> </span><span class="nx">may</span><span class="w"> </span><span class="nx">also</span><span class="w"> </span><span class="nx">be</span><span class="w"> </span><span class="nx">configured</span><span class="w"> </span><span class="nx">here</span><span class="p">.</span>
</code></pre></div>

<p>and specific services do create their logs in <code>/etc/logrotate.d/</code>:</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="c1"># cat /etc/logrotate.d/apt</span>
<span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">term</span><span class="o">.</span><span class="n">log</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">rotate</span><span class="w"> </span><span class="mi">12</span>
<span class="w">  </span><span class="n">monthly</span>
<span class="w">  </span><span class="n">compress</span>
<span class="w">  </span><span class="n">missingok</span>
<span class="w">  </span><span class="n">notifempty</span>
<span class="p">}</span>

<span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">apt</span><span class="o">/</span><span class="n">history</span><span class="o">.</span><span class="n">log</span><span class="w"> </span><span class="p">{</span>
<span class="w">  </span><span class="n">rotate</span><span class="w"> </span><span class="mi">12</span>
<span class="w">  </span><span class="n">monthly</span>
<span class="w">  </span><span class="n">compress</span>
<span class="w">  </span><span class="n">missingok</span>
<span class="w">  </span><span class="n">notifempty</span>
<span class="p">}</span>
</code></pre></div>

<p>These are the meaning of some of these parameters:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">parameter</th>
<th style="text-align: center;">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">weekly</td>
<td style="text-align: center;">rotate logs weekly</td>
</tr>
<tr>
<td style="text-align: center;">missingok</td>
<td style="text-align: center;">it is fine if there is no log for this week</td>
</tr>
<tr>
<td style="text-align: center;">rotate 52</td>
<td style="text-align: center;">keep the latest 52 logs and delete the older ones</td>
</tr>
<tr>
<td style="text-align: center;">compress</td>
<td style="text-align: center;">compress the logs</td>
</tr>
<tr>
<td style="text-align: center;">create 0640 www-data adm</td>
<td style="text-align: center;">create the files with this access and owners</td>
</tr>
<tr>
<td style="text-align: center;">pre &amp; post rotate</td>
<td style="text-align: center;">run these scripts or commands before and after the rotation</td>
</tr>
</tbody>
</table>
<p>This above configuration will create a zipped file for each week, keeping only 52 of them instead of a huge log file for this program.</p>
<p>The <code>logrotate</code> runs using crons and does its job on a daily basis based on a configuration on <code>/etc/cron.daily/logrotate</code></p>
<h2>some famous log files</h2>
<p>Generally logs are saved at <code>/var/log</code>. In case of any issue and if you do not know what to do, it is a common practice to run a <code>ls -ltrh /var/log/</code> to see if any program generated a new log or not.</p>
<p>But lets have a look at some of the famous logs:</p>
<h5><code>/var/log/auth.log</code> (in Debian Based)</h5>
<p>Authentication processes will log here. Things like <code>cron</code> jobs, failed logins, <code>sudo</code> informations, ...</p>
<h5><code>/var/log/syslog</code></h5>
<p>A centralized place most of the logs received by <code>rsyslogd</code> if a specific logfile is not provided in <code>/etc/rsyslog.conf</code></p>
<h5><code>/var/log/debug</code></h5>
<p>Debug information from programs.</p>
<h5><code>/var/log/kern.log</code></h5>
<p>Kernel messages.</p>
<h5><code>/var/log/messages</code></h5>
<p>Informative messages from services. This is also the default place for logs for remote clients.</p>
<h5><code>/var/run/utmp</code> &amp; <code>/var/log/wtmp</code></h5>
<p>Successful logins.</p>
<h5><code>/var/log/btmp</code></h5>
<p>Failed logins. You can check this to see if anyone is trying to guess your passwords!</p>
<h5><code>/var/log/faillog</code></h5>
<p>Failed authentication attempts.</p>
<h5><code>/var/log/lastlog</code></h5>
<p>Date and time of recent user logins.</p>
<h5>Service logs</h5>
<p>Service logs do create files or directories at <code>/var/log</code> and update their logs there. For example there might be a <code>/var/log/apache2/</code> (or <code>/var/log/httpd</code>) for the Apache HTTP server or a <code>/var/log/mysql</code> for the MySQL DB.</p>
<h2>rsyslog</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/xliHONdwFy0" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>This is the newer generation of syslogs and is used in many environments. Its main configuration is located at <code>/etc/rsyslog.conf</code> and it also reads anything in <code>/etc/rssylog.d/</code> directory. Its configuration consists of 3 main sections: </p>
<ol>
<li><code>MODULES</code>, modules used. For example to let the rsyslog use UDP connections</li>
<li><code>GLOBAL DIRECTIVES</code>, general configurations like directories accesses</li>
<li><code>RULES</code>, A combination of <em>facilities</em>, <em>priorities</em> and <em>actions</em> tells the <code>rsyslog</code> what to do with each log.</li>
</ol>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="o">~</span><span class="c1"># cat /etc/rsyslog.conf</span>
<span class="c1"># /etc/rsyslog.conf configuration file for rsyslog</span>
<span class="c1">#</span>
<span class="c1"># For more information install rsyslog-doc and see</span>
<span class="c1"># /usr/share/doc/rsyslog-doc/html/configuration/index.html</span>


<span class="c1">#################</span>
<span class="c1">#### MODULES ####</span>
<span class="c1">#################</span>

<span class="n">module</span><span class="p">(</span><span class="nb">load</span><span class="o">=</span><span class="s2">&quot;imuxsock&quot;</span><span class="p">)</span><span class="w"> </span><span class="c1"># provides support for local system logging</span>
<span class="n">module</span><span class="p">(</span><span class="nb">load</span><span class="o">=</span><span class="s2">&quot;imklog&quot;</span><span class="p">)</span><span class="w">   </span><span class="c1"># provides kernel logging support</span>
<span class="c1">#module(load=&quot;immark&quot;)  # provides --MARK-- message capability</span>

<span class="c1"># provides UDP syslog reception</span>
<span class="c1">#module(load=&quot;imudp&quot;)</span>
<span class="c1">#input(type=&quot;imudp&quot; port=&quot;514&quot;)</span>

<span class="c1"># provides TCP syslog reception</span>
<span class="c1">#module(load=&quot;imtcp&quot;)</span>
<span class="c1">#input(type=&quot;imtcp&quot; port=&quot;514&quot;)</span>


<span class="c1">###########################</span>
<span class="c1">#### GLOBAL DIRECTIVES ####</span>
<span class="c1">###########################</span>

<span class="c1">#</span>
<span class="c1"># Set the default permissions for all log files.</span>
<span class="c1">#</span>
<span class="o">$</span><span class="n">FileOwner</span><span class="w"> </span><span class="n">root</span>
<span class="o">$</span><span class="n">FileGroup</span><span class="w"> </span><span class="n">adm</span>
<span class="o">$</span><span class="n">FileCreateMode</span><span class="w"> </span><span class="mi">0640</span>
<span class="o">$</span><span class="n">DirCreateMode</span><span class="w"> </span><span class="mi">0755</span>
<span class="o">$</span><span class="n">Umask</span><span class="w"> </span><span class="mi">0022</span>

<span class="c1">#</span>
<span class="c1"># Where to place spool and state files</span>
<span class="c1">#</span>
<span class="o">$</span><span class="n">WorkDirectory</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="n">spool</span><span class="o">/</span><span class="n">rsyslog</span>

<span class="c1">#</span>
<span class="c1"># Include all config files in /etc/rsyslog.d/</span>
<span class="c1">#</span>
<span class="o">$</span><span class="n">IncludeConfig</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">rsyslog</span><span class="o">.</span><span class="n">d</span><span class="o">/*.</span><span class="n">conf</span>


<span class="c1">###############</span>
<span class="c1">#### RULES ####</span>
<span class="c1">###############</span>

<span class="c1">#</span>
<span class="c1"># Log anything besides private authentication messages to a single log file</span>
<span class="c1">#</span>
<span class="o">*.*</span><span class="p">;</span><span class="n">auth</span><span class="p">,</span><span class="n">authpriv</span><span class="o">.</span><span class="n">none</span><span class="w">      </span><span class="o">-/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">syslog</span>

<span class="c1">#</span>
<span class="c1"># Log commonly used facilities to their own log file</span>
<span class="c1">#</span>
<span class="n">auth</span><span class="p">,</span><span class="n">authpriv</span><span class="o">.*</span><span class="w">         </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">auth</span><span class="o">.</span><span class="n">log</span>
<span class="n">cron</span><span class="o">.*</span><span class="w">              </span><span class="o">-/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">cron</span><span class="o">.</span><span class="n">log</span>
<span class="n">kern</span><span class="o">.*</span><span class="w">              </span><span class="o">-/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">kern</span><span class="o">.</span><span class="n">log</span>
<span class="n">mail</span><span class="o">.*</span><span class="w">              </span><span class="o">-/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">mail</span><span class="o">.</span><span class="n">log</span>
<span class="n">user</span><span class="o">.*</span><span class="w">              </span><span class="o">-/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">user</span><span class="o">.</span><span class="n">log</span>

<span class="c1">#</span>
<span class="c1"># Emergencies are sent to everybody logged in.</span>
<span class="c1">#</span>
<span class="o">*.</span><span class="n">emerg</span><span class="w">             </span><span class="p">:</span><span class="n">omusrmsg</span><span class="p">:</span><span class="o">*</span>
</code></pre></div>

<p>As you can see <strong>facilities</strong> could be things like:</p>
<blockquote>
<p><code>kern</code>, <code>user</code>, <code>mail</code>, <code>daemon</code>, <code>cron</code>, <code>auth</code>, <code>ntp</code>, <code>security</code>, <code>console</code>, <code>syslog</code>, ... </p>
</blockquote>
<p>The <strong>priority</strong> could be one of the below:</p>
<blockquote>
<p><code>emerg</code>/<code>panic</code>, <code>alert</code>, <code>crit</code>, <code>err</code>/<code>error</code>, <code>warn</code>/<code>warning</code>, <code>notice</code>, <code>info</code> or <code>debug</code>. </p>
</blockquote>
<p>On the <strong>action</strong> part we can have things like these:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">action</th>
<th style="text-align: center;">sample</th>
<th style="text-align: left;">meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">filename</td>
<td style="text-align: center;">/usr/log/logins.log</td>
<td style="text-align: left;">will write the log to this file</td>
</tr>
<tr>
<td style="text-align: center;">username</td>
<td style="text-align: center;">jadi</td>
<td style="text-align: left;">will notify that person on the screen</td>
</tr>
<tr>
<td style="text-align: center;">@ip</td>
<td style="text-align: center;">@192.168.1.100</td>
<td style="text-align: left;">will send this log to this log server and that log server will decide what to do with it based on its configs</td>
</tr>
</tbody>
</table>
<p>So a line like this will show the kernel panics to a remote log server and also will log everything on every level to a log file:</p>
<div class="highlight"><pre><span></span><code>kern.panic      @192.168.1.100
*.*             /var/log/messages
</code></pre></div>

<p>If you log some specific priority, all the <strong>more important</strong> things will be logged too! So if you write <code>cron.notice /var/log/cron/cron.log</code>, you are logging the <code>emerg/panic</code>, <code>alert</code>, <code>critical</code>, <code>error</code>, <code>warning</code> and <code>notice</code> logs of the cron category too.</p>
<p>Priority Levels (According to Syslog(3) and logger manpage):</p>
<div class="highlight"><pre><span></span><code>       This determines the importance of the message.  The levels are, in order of decreasing importance:

       emerge      system is unusable

       alert      action must be taken immediately

       crit       critical conditions

       error        error conditions

       warning    warning conditions

       notice     normal, but significant, condition

       info       informational message

       debug      debug-level message


       panic      deprecated synonym for emerg
       error      deprecated synonym for err
       warn       deprecated synonym for warning
</code></pre></div>

<blockquote>
<p>If you need to log ONLY one specific level, add an equal sign (=) before the priority like this <code>local3.=alert /var/log/user.alert.log</code>.</p>
</blockquote>
<p>It is important to know that the binary which logs the <em>*kern</em> category is a standalone daemon. This daemon is called <code>klogd</code> and uses same configuration files. Why? so even after everything is crashed, <code>klogd</code> will be able to log the kernel's crashes ;).</p>
<h3>logger</h3>
<p>If you need to send something toward the <code>rsyslog</code>, you can use the <code>logger</code> tool. </p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="c1"># logger Testing my lovely tool</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="c1"># logger local1.emerg Nothing emergent for sure</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="c1"># tail -3 /var/log/syslog</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span><span class="n">T06</span><span class="p">:</span><span class="mi">05</span><span class="p">:</span><span class="mf">01.325358</span><span class="o">-</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">CRON</span><span class="p">[</span><span class="mi">914</span><span class="p">]:</span><span class="w"> </span><span class="p">(</span><span class="n">root</span><span class="p">)</span><span class="w"> </span><span class="n">CMD</span><span class="w"> </span><span class="p">(</span><span class="n">command</span><span class="w"> </span><span class="o">-</span><span class="n">v</span><span class="w"> </span><span class="n">debian</span><span class="o">-</span><span class="n">sa1</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="o">/</span><span class="n">dev</span><span class="o">/</span><span class="nb nb-Type">null</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">debian</span><span class="o">-</span><span class="n">sa1</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span><span class="n">T06</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">27.671410</span><span class="o">-</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">root</span><span class="p">:</span><span class="w"> </span><span class="n">Testing</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">lovely</span><span class="w"> </span><span class="k">tool</span>
<span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span><span class="n">T06</span><span class="p">:</span><span class="mi">13</span><span class="p">:</span><span class="mf">45.795158</span><span class="o">-</span><span class="mi">04</span><span class="p">:</span><span class="mi">00</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">root</span><span class="p">:</span><span class="w"> </span><span class="n">local1</span><span class="o">.</span><span class="n">emerg</span><span class="w"> </span><span class="n">Nothing</span><span class="w"> </span><span class="n">emergent</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">sure</span>
</code></pre></div>

<h2>journald</h2>
<iframe width="560" height="315" src="https://www.youtube.com/embed/jXO7q_7a6-s" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>

<p>You have seen the <code>systemd</code> in various parts of this course. We have seen how it is part of the init process and how it handles the services and timers. All of these activities (and other logs reaching system journalying system) are logged in binary files, readable using <code>journalctl</code> which is part of the <code>systemd-journald</code> utility.</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="o">~</span><span class="c1"># systemctl status systemd-journald</span>
<span class="err">●</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="o">.</span><span class="n">service</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Journal</span><span class="w"> </span><span class="n">Service</span>
<span class="w">     </span><span class="n">Loaded</span><span class="p">:</span><span class="w"> </span><span class="n">loaded</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">system</span><span class="o">/</span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="o">.</span><span class="n">service</span><span class="p">;</span><span class="w"> </span><span class="k">static</span><span class="p">)</span>
<span class="w">     </span><span class="n">Active</span><span class="p">:</span><span class="w"> </span><span class="n">active</span><span class="w"> </span><span class="p">(</span><span class="n">running</span><span class="p">)</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">Fri</span><span class="w"> </span><span class="mi">2023</span><span class="o">-</span><span class="mi">06</span><span class="o">-</span><span class="mi">30</span><span class="w"> </span><span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="n">EDT</span><span class="p">;</span><span class="w"> </span><span class="mi">52</span><span class="nb">min</span><span class="w"> </span><span class="n">ago</span>
<span class="n">TriggeredBy</span><span class="p">:</span><span class="w"> </span><span class="err">●</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="o">-</span><span class="n">dev</span><span class="o">-</span><span class="nb">log</span><span class="o">.</span><span class="n">socket</span>
<span class="w">             </span><span class="err">●</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="o">-</span><span class="n">audit</span><span class="o">.</span><span class="n">socket</span>
<span class="w">             </span><span class="err">●</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="o">.</span><span class="n">socket</span>
<span class="w">       </span><span class="n">Docs</span><span class="p">:</span><span class="w"> </span><span class="n">man</span><span class="p">:</span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="o">.</span><span class="n">service</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="w">             </span><span class="n">man</span><span class="p">:</span><span class="n">journald</span><span class="o">.</span><span class="n">conf</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="w">   </span><span class="n">Main</span><span class="w"> </span><span class="n">PID</span><span class="p">:</span><span class="w"> </span><span class="mi">261</span><span class="w"> </span><span class="p">(</span><span class="n">systemd</span><span class="o">-</span><span class="n">journal</span><span class="p">)</span>
<span class="w">     </span><span class="n">Status</span><span class="p">:</span><span class="w"> </span><span class="s2">&quot;Processing requests...&quot;</span>
<span class="w">      </span><span class="n">Tasks</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="p">(</span><span class="n">limit</span><span class="p">:</span><span class="w"> </span><span class="mi">4583</span><span class="p">)</span>
<span class="w">     </span><span class="n">Memory</span><span class="p">:</span><span class="w"> </span><span class="mf">17.1</span><span class="n">M</span>
<span class="w">        </span><span class="n">CPU</span><span class="p">:</span><span class="w"> </span><span class="mi">138</span><span class="n">ms</span>
<span class="w">     </span><span class="n">CGroup</span><span class="p">:</span><span class="w"> </span><span class="o">/</span><span class="n">system</span><span class="o">.</span><span class="n">slice</span><span class="o">/</span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="o">.</span><span class="n">service</span>
<span class="w">             </span><span class="err">└─</span><span class="mi">261</span><span class="w"> </span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span>

<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="p">[</span><span class="mi">261</span><span class="p">]:</span><span class="w"> </span><span class="n">Journal</span><span class="w"> </span><span class="n">started</span>
<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="p">[</span><span class="mi">261</span><span class="p">]:</span><span class="w"> </span><span class="n">Runtime</span><span class="w"> </span><span class="n">Journal</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="n">run</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="n">ec22e43962c64359b9b25cfa650b025b</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="mf">4.9</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="mf">39.1</span><span class="n">M</span><span class="p">,</span><span class="o">&gt;</span>
<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="p">[</span><span class="mi">261</span><span class="p">]:</span><span class="w"> </span><span class="n">Time</span><span class="w"> </span><span class="n">spent</span><span class="w"> </span><span class="n">on</span><span class="w"> </span><span class="n">flushing</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="n">ec22e43962c64359b9b25cfa650b025b</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="mf">23.816</span><span class="n">ms</span><span class="o">&gt;</span>
<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="p">[</span><span class="mi">261</span><span class="p">]:</span><span class="w"> </span><span class="n">System</span><span class="w"> </span><span class="n">Journal</span><span class="w"> </span><span class="p">(</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="n">ec22e43962c64359b9b25cfa650b025b</span><span class="p">)</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="mf">28.2</span><span class="n">M</span><span class="p">,</span><span class="w"> </span><span class="nb">max</span><span class="w"> </span><span class="mf">4.0</span><span class="n">G</span><span class="p">,</span><span class="w"> </span><span class="o">&gt;</span>
<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">05</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">50</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">systemd</span><span class="o">-</span><span class="n">journald</span><span class="p">[</span><span class="mi">261</span><span class="p">]:</span><span class="w"> </span><span class="n">Received</span><span class="w"> </span><span class="n">client</span><span class="w"> </span><span class="n">request</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">flush</span><span class="w"> </span><span class="n">runtime</span><span class="w"> </span><span class="n">journal</span><span class="o">.</span>
<span class="n">Notice</span><span class="p">:</span><span class="w"> </span><span class="n">journal</span><span class="w"> </span><span class="n">has</span><span class="w"> </span><span class="n">been</span><span class="w"> </span><span class="n">rotated</span><span class="w"> </span><span class="n">since</span><span class="w"> </span><span class="n">unit</span><span class="w"> </span><span class="n">was</span><span class="w"> </span><span class="n">started</span><span class="p">,</span><span class="w"> </span><span class="n">output</span><span class="w"> </span><span class="n">may</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">incomplete</span><span class="o">.</span>
</code></pre></div>

<p>and here is the configuration file:</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="nv">@debian</span><span class="err">:</span><span class="o">~</span><span class="err">#</span><span class="w"> </span><span class="n">cat</span><span class="w"> </span><span class="o">/</span><span class="n">etc</span><span class="o">/</span><span class="n">systemd</span><span class="o">/</span><span class="n">journald</span><span class="p">.</span><span class="n">conf</span>
<span class="err">#</span><span class="w">  </span><span class="n">This</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">part</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">systemd</span><span class="p">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w">  </span><span class="n">systemd</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="k">free</span><span class="w"> </span><span class="n">software</span><span class="p">;</span><span class="w"> </span><span class="n">you</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">redistribute</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="ow">and</span><span class="o">/</span><span class="ow">or</span><span class="w"> </span><span class="k">modify</span><span class="w"> </span><span class="n">it</span><span class="w"> </span><span class="k">under</span><span class="w"> </span><span class="n">the</span>
<span class="err">#</span><span class="w">  </span><span class="n">terms</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">GNU</span><span class="w"> </span><span class="n">Lesser</span><span class="w"> </span><span class="k">General</span><span class="w"> </span><span class="k">Public</span><span class="w"> </span><span class="n">License</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="n">published</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">Free</span>
<span class="err">#</span><span class="w">  </span><span class="n">Software</span><span class="w"> </span><span class="n">Foundation</span><span class="p">;</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="n">version</span><span class="w"> </span><span class="mf">2.1</span><span class="w"> </span><span class="k">of</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">License</span><span class="p">,</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="p">(</span><span class="k">at</span><span class="w"> </span><span class="n">your</span><span class="w"> </span><span class="k">option</span><span class="p">)</span>
<span class="err">#</span><span class="w">  </span><span class="ow">any</span><span class="w"> </span><span class="n">later</span><span class="w"> </span><span class="n">version</span><span class="p">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="n">Entries</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="n">show</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">compile</span><span class="w"> </span><span class="nc">time</span><span class="w"> </span><span class="n">defaults</span><span class="p">.</span><span class="w"> </span><span class="k">Local</span><span class="w"> </span><span class="n">configuration</span>
<span class="err">#</span><span class="w"> </span><span class="n">should</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">created</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">either</span><span class="w"> </span><span class="n">modifying</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">file</span><span class="p">,</span><span class="w"> </span><span class="ow">or</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">creating</span><span class="w"> </span><span class="ss">&quot;drop-ins&quot;</span><span class="w"> </span><span class="ow">in</span>
<span class="err">#</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="n">journald</span><span class="p">.</span><span class="n">conf</span><span class="p">.</span><span class="n">d</span><span class="o">/</span><span class="w"> </span><span class="n">subdirectory</span><span class="p">.</span><span class="w"> </span><span class="n">The</span><span class="w"> </span><span class="n">latter</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">generally</span><span class="w"> </span><span class="n">recommended</span><span class="p">.</span>
<span class="err">#</span><span class="w"> </span><span class="n">Defaults</span><span class="w"> </span><span class="n">can</span><span class="w"> </span><span class="n">be</span><span class="w"> </span><span class="n">restored</span><span class="w"> </span><span class="k">by</span><span class="w"> </span><span class="n">simply</span><span class="w"> </span><span class="n">deleting</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="k">file</span><span class="w"> </span><span class="ow">and</span><span class="w"> </span><span class="ow">all</span><span class="w"> </span><span class="k">drop</span><span class="o">-</span><span class="n">ins</span><span class="p">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="k">Use</span><span class="w"> </span><span class="s1">&#39;systemd-analyze cat-config systemd/journald.conf&#39;</span><span class="w"> </span><span class="k">to</span><span class="w"> </span><span class="n">display</span><span class="w"> </span><span class="n">the</span><span class="w"> </span><span class="k">full</span><span class="w"> </span><span class="n">config</span><span class="p">.</span>
<span class="err">#</span>
<span class="err">#</span><span class="w"> </span><span class="n">See</span><span class="w"> </span><span class="n">journald</span><span class="p">.</span><span class="n">conf</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">details</span><span class="p">.</span>

<span class="o">[</span><span class="n">Journal</span><span class="o">]</span>
<span class="n">#Storage</span><span class="o">=</span><span class="n">auto</span>
<span class="n">#Compress</span><span class="o">=</span><span class="n">yes</span>
<span class="n">#Seal</span><span class="o">=</span><span class="n">yes</span>
<span class="n">#SplitMode</span><span class="o">=</span><span class="n">uid</span>
<span class="n">#SyncIntervalSec</span><span class="o">=</span><span class="mi">5</span><span class="n">m</span>
<span class="n">#RateLimitIntervalSec</span><span class="o">=</span><span class="mi">30</span><span class="n">s</span>
<span class="n">#RateLimitBurst</span><span class="o">=</span><span class="mi">10000</span>
<span class="n">#SystemMaxUse</span><span class="o">=</span>
<span class="n">#SystemKeepFree</span><span class="o">=</span>
<span class="n">#SystemMaxFileSize</span><span class="o">=</span>
<span class="n">#SystemMaxFiles</span><span class="o">=</span><span class="mi">100</span>
<span class="n">#RuntimeMaxUse</span><span class="o">=</span>
<span class="n">#RuntimeKeepFree</span><span class="o">=</span>
<span class="n">#RuntimeMaxFileSize</span><span class="o">=</span>
<span class="n">#RuntimeMaxFiles</span><span class="o">=</span><span class="mi">100</span>
<span class="n">#MaxRetentionSec</span><span class="o">=</span>
<span class="n">#MaxFileSec</span><span class="o">=</span><span class="mi">1</span><span class="nf">month</span>
<span class="n">#ForwardToSyslog</span><span class="o">=</span><span class="n">yes</span>
<span class="n">#ForwardToKMsg</span><span class="o">=</span><span class="k">no</span>
<span class="n">#ForwardToConsole</span><span class="o">=</span><span class="k">no</span>
<span class="n">#ForwardToWall</span><span class="o">=</span><span class="n">yes</span>
<span class="n">#TTYPath</span><span class="o">=/</span><span class="n">dev</span><span class="o">/</span><span class="n">console</span>
<span class="n">#MaxLevelStore</span><span class="o">=</span><span class="n">debug</span>
<span class="n">#MaxLevelSyslog</span><span class="o">=</span><span class="n">debug</span>
<span class="n">#MaxLevelKMsg</span><span class="o">=</span><span class="n">notice</span>
<span class="n">#MaxLevelConsole</span><span class="o">=</span><span class="n">info</span>
<span class="n">#MaxLevelWall</span><span class="o">=</span><span class="n">emerg</span>
<span class="n">#LineMax</span><span class="o">=</span><span class="mi">48</span><span class="n">K</span>
<span class="n">#ReadKMsg</span><span class="o">=</span><span class="n">yes</span>
<span class="n">#Audit</span><span class="o">=</span><span class="k">no</span>
</code></pre></div>

<h3>querying journal contents</h3>
<p>If you run the <code>journalctl</code> you will get all the logs... too much. So there are some useful switches:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Switch</th>
<th style="text-align: center;">Meaning</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">-r</td>
<td style="text-align: center;">show in reverse; newer on top</td>
</tr>
<tr>
<td style="text-align: center;">-f</td>
<td style="text-align: center;">keep showing the tail</td>
</tr>
<tr>
<td style="text-align: center;">-e</td>
<td style="text-align: center;">show and go to the end</td>
</tr>
<tr>
<td style="text-align: center;">-n</td>
<td style="text-align: center;">show this many lines from the end (newest ones)</td>
</tr>
<tr>
<td style="text-align: center;">-k</td>
<td style="text-align: center;">show kernel message (equal to <code>dmesg</code>)</td>
</tr>
<tr>
<td style="text-align: center;">-b</td>
<td style="text-align: center;">show from a specific boot, -1 is the previous one, 0 is the current one. You can check the list using <code>--list-boots</code></td>
</tr>
<tr>
<td style="text-align: center;">-p</td>
<td style="text-align: center;">from specific priority, say <code>-p err</code></td>
</tr>
<tr>
<td style="text-align: center;">-u</td>
<td style="text-align: center;">from a specific systemd unit</td>
</tr>
</tbody>
</table>
<p>You can also use the <code>--since</code> and <code>--until</code> to show a specific time range, It is possible to provide time as <code>YYYY-MM-DD HH:MM:SS</code> or use things like <code>yesterday</code>, <code>today</code>, <code>tomorrow</code>, <code>now</code> or even <code>--since "10 minutes ago"</code> which is equals to <code>--since "-2 minutes"</code>.</p>
<blockquote>
<p>If there are too many lines, push <code>&gt;</code> to jump to the end (or <code>&lt;</code> to go to the beginning)</p>
</blockquote>
<p>You can also add the name of the program to the command to see the logs from that specific program; say <code>journalctl /usr/bin/xrdp</code> or use some fields like <code>PRIORITY=</code>, <code>_PID=</code> and provide values.</p>
<h3>systemd-cat</h3>
<p>This tools is used when you want to manually send logs to the journaling system. It sends its input to the journal or if provided, runs the command and sends the result to the journal.</p>
<div class="highlight"><pre><span></span><code><span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="o">~</span><span class="c1"># echo &quot;This is my first test&quot; | systemd-cat</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="o">~</span><span class="c1"># systemd-cat -p info uptime #sending priority too</span>
<span class="n">root</span><span class="err">@</span><span class="n">debian</span><span class="p">:</span><span class="o">~</span><span class="c1"># journalctl -n 3</span>
<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">06</span><span class="p">:</span><span class="mi">31</span><span class="p">:</span><span class="mi">01</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">systemd</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span><span class="w"> </span><span class="n">Finished</span><span class="w"> </span><span class="n">apt</span><span class="o">-</span><span class="n">daily</span><span class="o">.</span><span class="n">service</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">Daily</span><span class="w"> </span><span class="n">apt</span><span class="w"> </span><span class="n">download</span><span class="w"> </span><span class="n">activities</span><span class="o">.</span>
<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">06</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">18</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">cat</span><span class="p">[</span><span class="mi">1020</span><span class="p">]:</span><span class="w"> </span><span class="n">This</span><span class="w"> </span><span class="k">is</span><span class="w"> </span><span class="n">my</span><span class="w"> </span><span class="n">first</span><span class="w"> </span><span class="n">test</span>
<span class="n">Jun</span><span class="w"> </span><span class="mi">30</span><span class="w"> </span><span class="mi">06</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">48</span><span class="w"> </span><span class="n">debian</span><span class="w"> </span><span class="n">uptime</span><span class="p">[</span><span class="mi">1022</span><span class="p">]:</span><span class="w">  </span><span class="mi">06</span><span class="p">:</span><span class="mi">34</span><span class="p">:</span><span class="mi">48</span><span class="w"> </span><span class="n">up</span><span class="w">  </span><span class="mi">1</span><span class="p">:</span><span class="mi">05</span><span class="p">,</span><span class="w">  </span><span class="mi">4</span><span class="w"> </span><span class="n">users</span><span class="p">,</span><span class="w">  </span><span class="nb">load</span><span class="w"> </span><span class="n">average</span><span class="p">:</span><span class="w"> </span><span class="mf">0.00</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00</span><span class="p">,</span><span class="w"> </span><span class="mf">0.00</span>
</code></pre></div>

<h2>managing storage</h2>
<p>The systemd journals can keep their logs in memeory or write them to the disk or drop all the logs. This is determined by the configurations in <code>/etc/systemd/journald.conf</code>. But the default behaviour is as follow:</p>
<ol>
<li>The system checks the <code>/var/log/journal</code>. If this directory, exists logs will be saved in a directory inside this. The name of the directory will be decided by looking at <code>/etc/machine-id</code></li>
<li>If the <code>/var/log/journal</code> is not there, the logs will be saved in memory at <code>/run/log/jouranl</code> and in the directory decided by <code>/etc/machine-id</code>.</li>
</ol>
<p>But you can overcome these configs by the following sections:</p>
<div class="highlight"><pre><span></span><code><span class="nv">Storage</span><span class="o">=</span><span class="nv">volatile</span><span class="w">     </span>#<span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">logs</span><span class="w"> </span><span class="nv">in</span><span class="w"> </span><span class="nv">memory</span>
<span class="nv">Storage</span><span class="o">=</span><span class="nv">persistent</span><span class="w">   </span>#<span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="nv">on</span><span class="w"> </span><span class="nv">disk</span>,<span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">needed</span><span class="w"> </span><span class="nv">create</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">directories</span>
<span class="nv">Storage</span><span class="o">=</span><span class="nv">auto</span><span class="w">         </span>#<span class="w"> </span><span class="nv">will</span><span class="w"> </span><span class="nv">write</span><span class="w"> </span><span class="nv">to</span><span class="w"> </span><span class="nv">disk</span><span class="w"> </span><span class="nv">only</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="nv">the</span><span class="w"> </span><span class="nv">directory</span><span class="w"> </span><span class="nv">exists</span>
<span class="nv">Storage</span><span class="o">=</span><span class="nv">none</span><span class="w">         </span>#<span class="w"> </span><span class="k">do</span><span class="w"> </span><span class="nv">not</span><span class="w"> </span><span class="nv">keep</span><span class="w"> </span><span class="nv">logs</span>
</code></pre></div>

<p>If the logs are being written to disk, these variable will manage the disk usage:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Variable Name</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">SystemMaxUse</td>
<td>The Maximum disk usage, say 500M. The default is on <code>10%</code></td>
</tr>
<tr>
<td style="text-align: center;">SystemKeepFree</td>
<td>Keep at least this much free, say 1G. The default is 15%</td>
</tr>
<tr>
<td style="text-align: center;">SystemMaxFileSize</td>
<td>Maximum size of each individual file. The default is 1/8 of SystemMaxUse</td>
</tr>
<tr>
<td style="text-align: center;">SystemMaxFiles</td>
<td>Max number of non-currently-active files. The default is 100</td>
</tr>
</tbody>
</table>
<p>If you are keeping the logs in <strong>memory</strong>, the equivalent variables are <code>RuntimeMaxUse</code>, <code>RuntimeKeepFree</code>, <code>RuntimeMaxFileSize</code>, &amp; <code>RuntimeMaxFiles</code>.  </p>
<p>In case you need to do the clean-up manually (with the help of systemd tools for sure), you can run <code>journalctl</code> with these switches:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">Switch</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">--vacuum-time</td>
<td>clean everything older than this. for example <code>--vacuum-time=3months</code> clean anything older than 3 months. You can use <code>s</code>, <code>m</code>, <code>h</code> for seconds, minutes and days and <code>d</code>/<code>days</code>, <code>months</code>, <code>weeks</code>/<code>w</code> and <code>years</code>/<code>y</code>.</td>
</tr>
<tr>
<td style="text-align: center;">--vacuum-size</td>
<td>eliminate till logs occupy a specific size; say 1G</td>
</tr>
<tr>
<td style="text-align: center;">--vacuum-files</td>
<td>Only keep this much archive files</td>
</tr>
</tbody>
</table>
<h3>checking logs from a recovered system</h3>
<p>If you have a crashed / non-booting system, you can still examine its logs; if the files are there. As you know the files are in <code>/var/log/journal/{mchine-id}</code> where machine-id is in <code>/etc/machine-id</code> of the crashed machine. </p>
<p>You can move these files to a directory after booting the crashed machine with a live linux or mount its hard on another machine or even examine them in place. The <code>-D</code> (or <code>--directory</code>) switch of <code>journalctl</code> indicates the location of the journal files. So if your crashed machine id is <code>ec22e43962c64359b9b25cfa650b025b</code> and you've mounted its <code>/var/</code> under your <code>/mnt/var/</code> directory, you can issue this command to read its logs and see what had happened:</p>
<div class="highlight"><pre><span></span><code><span class="n">journalctl</span><span class="w"> </span><span class="o">-</span><span class="n">D</span><span class="o">=/</span><span class="n">mnt</span><span class="o">/</span><span class="k">var</span><span class="o">/</span><span class="nb">log</span><span class="o">/</span><span class="n">journal</span><span class="o">/</span><span class="n">ec22e43962c64359b9b25cfa650b025b</span><span class="o">/</span>
</code></pre></div>

<p>You can also use the <code>--merge</code> switch to merge these logs into your machine or use <code>--file</code> to check only one specific journal file. Lastly if the exact location of journal files are not known, you can use <code>--root /mnt</code> and tell the <code>journalctl</code> to search there for journal files.</p>


             
 
            
            
            







            <hr/>

            <!-- show next and previous links -->
            <table style="background: white; border: 0; font-size: 0.8em;"><tr>
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                
                <td style="background: white; border: 0;">
                            <a href="./1081-maintain-system-time.html">← 108.1 Maintain system time</a>
                </td>
                <td style="background: white; border: 0;"><center ><a href="/archives.html">Chapter List</a></center></td>
                <td style="background: white; border: 0; text-align: right;">
                            <a href="./1083-mail-transfer-agent-mta-basics.html">108.3 Mail Transfer Agent (MTA) basics →</a>
                </td>
                
                
                
                
                
                
                
                
                
            </tr></table>
            
            <hr />


	<div class=comment>

<div id="disqus_thread"></div>
<script>
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://linux1st.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


	</div>
        </div>
        <section id="article-sidebar" class="span2">
            <h4>Category</h4>
            <a class="category-link" href="./categories.html#lpic1-ref">LPIC1</a>
            <h4>Tags</h4>
            <ul class="list-of-tags tags-in-article">
                <li><a href="./tags.html#102-ref">102
                    <span class="superscript">20</span>
</a></li>
                <li><a href="./tags.html#lpic1-ref">LPIC1
                    <span class="superscript">42</span>
</a></li>
                <li><a href="./tags.html#lpic1-102-500-ref">LPIC1-102-500
                    <span class="superscript">20</span>
</a></li>
            </ul>
<h4>Contact</h4>
<div id="sidebar-social-link">
</div>
            





            





        </section>
</div>
</article>
<!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe.
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides.
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo https://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>                    </div>
                    <div class="span1"></div>
                </div>
            </div>
        </div>
<footer>




    <div id="fpowered">
        Powered by: <a href="http://getpelican.com/" title="Pelican Home Page" target="_blank" rel="nofollow noopener noreferrer">Pelican</a>
        Theme: <a href="https://elegant.oncrashreboot.com/" title="Theme Elegant Home Page" target="_blank" rel="nofollow noopener noreferrer">Elegant</a>
    </div>
</footer>            <script src="//code.jquery.com/jquery.min.js"></script>
        <script src="//netdna.bootstrapcdn.com/twitter-bootstrap/2.3.2/js/bootstrap.min.js"></script>
        <script src="./theme/js/elegant.prod.9e9d5ce754.js"></script>
        <script>
            function validateForm(query)
            {
                return (query.length > 0);
            }
        </script>

    <script>
    (function () {
        if (window.location.hash.match(/^#comment-\d+$/)) {
            $('#comment_thread').collapse('show');
        }
    })();
    window.onhashchange=function(){
        if (window.location.hash.match(/^#comment-\d+$/))
            window.location.reload(true);
    }
    $('#comment_thread').on('shown', function () {
        var link = document.getElementById('comment-accordion-toggle');
        var old_innerHTML = link.innerHTML;
        $(link).fadeOut(200, function() {
            $(this).text('Click here to hide comments').fadeIn(200);
        });
        $('#comment_thread').on('hidden', function () {
            $(link).fadeOut(200, function() {
                $(this).text(old_innerHTML).fadeIn(200);
            });
        })
    })
</script>

    </body>
    <!-- Theme: Elegant built for Pelican
        License : MIT -->
</html>